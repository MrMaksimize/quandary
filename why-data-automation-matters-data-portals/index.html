<!DOCTYPE html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Why data automation matters for open data portals</title><meta name=description content="Be honest. When you read the words data automation you get a sudden rush of melatonin to your brain, your eyelids get heavy, and you get an uncontrollable urge to fall asleep. Don&rsquo;t be ashame..."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><meta name=twitter:card content="summary"><meta name=twitter:site content="@MrMaksimize"><meta name=twitter:title content="Why data automation matters for open data portals"><meta name=twitter:image content="http://quandary.io/assets/images/logo_white.png"><meta name=twitter:description content="Be honest. When you read the words data automation you get a sudden rush of melatonin to your brain, your eyelids get heavy, and you get an uncontrollable urge to fall asleep. Don&rsquo;t be ashame..."><meta property=og:site_name content="Quandary."><meta property=og:title content="Why data automation matters for open data portals"><meta property=og:description content="Be honest. When you read the words data automation you get a sudden rush of melatonin to your brain, your eyelids get heavy, and you get an uncontrollable urge to fall asleep. Don&rsquo;t be ashame..."><meta property=og:image content="http://quandary.io/assets/images/airflow-dsd-approvals.jpg"><meta property=og:url content="http://quandary.io/why-data-automation-matters-data-portals/"><meta property=og:type content="blog"><meta property=article:published_time content=2017-04-27T00:00:00+00:00><link rel=canonical href="http://quandary.io/why-data-automation-matters-data-portals/"><link rel="shortcut icon" href=/assets/images/favicon.png type="image/png"><link rel=stylesheet href=//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i><link href=//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css rel=stylesheet><link href="//fonts.googleapis.com/css?family=Merriweather" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=/atom.xml><link rel=stylesheet type=text/css media=screen href="/css/main.css"><link rel=stylesheet type=text/css media=print href="/css/print.css"></head><body itemscope itemtype=http://schema.org/Article><a href="/" class=logo-readium><span class=logo style="background-image: url(/assets/images/logo_white.png)"></span></a><main class=content role=main><article class=post><div class=article-image><div class=post-image-image style="background-image: url(/assets/images/airflow-dsd-approvals.jpg)">Article Image</div><div class=post-image-image2 style="background-image: url()">Article Image</div><div class=post-meta><h1 class=post-title>Why data automation matters for open data portals</h1><div class="cf post-meta-text"><div class=author-image style="background-image: url(/assets/images/author.jpg)">Blog Logo</div><h4 class=author-name itemprop=author itemscope itemtype=http://schema.org/Person>Maksim Pecherskiy</h4>on <time datetime="2017-04-27 00:00">27 Apr 2017</time></div><div style=text-align:center><a href=#topofpage class=topofpage><i class="fa fa-angle-down"></i></a></div></div></div><section class=post-content><div class=post-reading><span class=post-reading-time></span> read</div><a name=topofpage></a><p>Be honest. When you read the words data automation you get a sudden rush of melatonin to your brain, your eyelids get heavy, and you get an uncontrollable urge to fall asleep. Don&rsquo;t be ashamed; you are reacting to these words in a similar manner to 99.5% of people on the planet. Bear with me though for just a few paragraphs while I try to explain why it matters, and how we do it here at the City of San Diego.</p><p>Before we get started, let me promise to not use any of the following:</p><ul><li>Mathematics (or any subset thereof)</li><li>Buzzwords</li><li>Tech Jargon</li></ul><h3>The Quick Win</h3><p>One of the best case studies to make obvious the benefits of data automation is <a href=http://streets.sandiego.gov>StreetsSD</a>. We started working on this project with the City&rsquo;s Transportation and Stormwater Department (TSW). They asked us to build a map of paving projects. We got a spreadsheet of data from the department, loaded it into <a href=http://carto.com>our mapping tool</a> and wrote some code. Boom, we had a map.</p><p><img src=/assets/images/carto_editor.jpg alt=Carto></p><h3>The Ugly Loss</h3><p>Most web maps, charts, and data visualizations you see in newspapers, and even those created by a lot of cities, usually stop there. That&rsquo;s actually OK because a lot of these things don&rsquo;t need to be updated automatically. However, the goal of StreetsSD is to provide an up-to-date status of work to city employees and residents. Keeping the map updated is important.</p><p>The typical City approach in these situations is to have someone &ldquo;run a report&rdquo; and upload it somewhere to update the map. Most of the time, &ldquo;running a report&rdquo; actually means this:</p><ul><li>Extract data from a database, using a query (that could change, resulting in different data).</li><li>Complete 1-40 manual steps in Excel to clean the data. These steps are usually not documented anywhere and could easily vary for each run of the report.</li><li>Send it or upload it somewhere.</li></ul><p>This approach inherently has several problems:</p><ul><li>Data is inconsistent, meaning source of truth is inconsistent</li><li>Bad data potentially causes bugs in the application</li><li>City employees waste a HUGE amount of time</li><li>People might forget to actually run the report</li><li>We can&rsquo;t expect someone to run a report every day (or with any kind of frequency that a continously update data source needs).</li></ul><p>Needless to say, this sucks. And even though we&rsquo;re creating a great operational tool, we&rsquo;re costing people time and risking the release of wrong information.</p><p>At this point, being the wise reader you are, you might be thinking that the outcome would definitely be worth the cost in the case of just one map. To which I&rsquo;ll respond with:</p><p><img src=/assets/images/systemic_issue.jpg alt="Systemic issue"></p><p>This is not a problem with just one map. It would occur with any dataset we provide as open data on the portal, anything we build on top of those datasets, and any internal or external reports we regularly generate. Therefore, this is a problem that needs to be solved at a systemic level.</p><h3>Redemption</h3><p>Our philosophy has always been to let machines do what they do best - updating data, re-running things, keeping track of things - and humans do what they do best - making those fuzzy decisions that only our brains can.</p><p>We needed a flexible and extensible solution that could scale across the organization as a whole.</p><p><img src=/assets/images/sd_sources.jpg alt="CSD Data Sources"></p><p>We turned to an open source project called <a href="https://github.com/apache/incubator-airflow/">Airflow</a>. It has become the tool of choice for Spotify, IFTTT, Lyft, AirBnB and many others for solving this exact set of problems. Airflow has several advantages:</p><ul><li>Built in Python - so it&rsquo;s extensible with any of thousands of Python open-source packages</li><li>Modular - new connections to different data sources are easy to write</li><li>Open source with a strong community - so there&rsquo;s plenty of support and continuous updates</li><li>Scalable - as we need to do more and more, Airflow easily scales</li></ul><p>We called our Airflow deployment Poseidon because codenames are cool, San Diego is on the Ocean, and Poseidon rules the sea. Plus, we get to use images like these: <img src=/assets/images/poseidon-hero.jpg alt=Poseidon></p><p>The basic idea of Poseidon is this:</p><p><img src=/assets/images/simple_etl.jpg alt="Basic ETL"></p><ul><li>Get data from a source (database, spreadsheet, map, website)</li><li>Do some stuff to it (geocode it, aggregate it, clean it)</li><li>Upload it (put it on the cloud that is backing our portal and a variety of other applications)</li><li>Run it on a schedule (once every 5 minutes, OR once every day, OR on every odd day of the month at 3:02 PM)</li></ul><p>Simple, right?</p><p>We&rsquo;re now doing this for all of our datasets (way harder to implement than explain). This means we&rsquo;re also doing it for everything built on top of our data, such as StreetsSD, the portal, and various other visualizations.</p><h3>The Open Sea</h3><p>Now you&rsquo;re probably thinking: whoop-de-doo, I&rsquo;m a resident and I don&rsquo;t know data, so I really don&rsquo;t care that you now have automated data.</p><p>We know. That&rsquo;s why we pushed it further.</p><p>Look back at the diagram above. Those are just dependent pieces that run in a defined cycle. What if we flipped out some of those pieces and got this?</p><p><img src=/assets/images/adv_flow_diagram.jpg alt="Adv Flow"></p><p>Automated data is now starting to get interesting. Because of Poseidon&rsquo;s flexibility, and the fact that it&rsquo;s just a bunch of coordinated tasks, we can send automatic notifications, alerts based on thresholds, and all kinds of other cool stuff that would never have been possible without automation.</p><p>But if I told you what we were planning next, I&rsquo;d ruin the surprise. You&rsquo;ll just have to wait and see.</p></section><footer class=post-footer><section class=share></section></footer><div class="bottom-teaser cf"><div class=isLeft><h5 class="index-headline featured"><span>Written by</span></h5><section class=author><div class=author-image style="background-image: url(/assets/images/author.jpg)">Blog Logo</div><h4>Maksim Pecherskiy</h4><p class=bio></p><hr><p class=published>Published <time datetime="2017-04-27 00:00">27 Apr 2017</time></p></section></div><div class=isRight><h5 class="index-headline featured"><span>Supported by</span></h5><footer class=site-footer><section class=poweredby>Proudly published with <a href=http://jekyllrb.com>Jekyll</a></section><a class=subscribe href=/feed.xml><span class=tooltip><i class="fa fa-rss"></i> You should subscribe to my feed.</span></a><div class=inner><section class=copyright>All content copyright <a href="/">Maksim Pecherskiy</a> &copy; 2017<br>All rights reserved.</section></div></footer></div></div></article></main><div class=bottom-closer><div class=background-closer-image style="background-image: url(/assets/images/harddrive.jpg)">Image</div><div class=inner><h1 class=blog-title>Quandary.</h1><h2 class=blog-description>An Experiment</h2><a href="/" class=btn>Back to Overview</a></div></div><script src=https://code.jquery.com/jquery-1.11.1.min.js></script><script type=text/javascript src=/assets/js/jquery.fitvids.js></script><script type=text/javascript src=/assets/js/index.js></script><script type=text/javascript src=/assets/js/readingTime.min.js></script><script>(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));</script></body></html>